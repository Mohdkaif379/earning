<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ReviewEarn - Google review dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    .reward-link { transition: all 0.2s ease; }
  </style>
</head>
<body class="min-h-screen bg-[#fdf0d5] text-amber-950">

  <div class="bg-[#fff8ea]/95 backdrop-blur-sm border-b border-amber-300 sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-4 flex flex-col gap-3 sm:flex-row sm:justify-between sm:items-center">
      <div class="flex items-center gap-2">
        <div class="h-9 w-9 rounded-xl bg-gradient-to-br from-yellow-400 to-amber-500 flex items-center justify-center">
          <i class="fas fa-star text-white text-sm"></i>
        </div>
        <span class="font-bold text-xl text-amber-950">EarnMoney</span>
      </div>

      <div class="flex w-full sm:w-auto items-center gap-2 sm:gap-3 flex-wrap sm:flex-nowrap">
        <a href="/wallet" class="flex items-center gap-2 bg-[#fdf0d5] px-3 sm:px-4 py-2 rounded-full border border-amber-300 text-amber-900 transition hover:bg-amber-100">
          <i class="fas fa-wallet text-amber-700"></i>
          <span class="font-semibold" id="walletAmount"><%= wallet %></span>
        </a>
        <a href="/recharge" class="flex items-center gap-2 bg-emerald-100 px-3 sm:px-4 py-2 rounded-full border border-emerald-300 text-emerald-800 transition hover:bg-emerald-200">
          <i class="fas fa-bolt"></i>
          <span>Recharge</span>
        </a>
        <a href="/logout" class="flex items-center gap-2 bg-red-100 px-3 sm:px-4 py-2 rounded-full border border-red-300 text-red-700 transition hover:bg-red-200">
          <i class="fas fa-right-from-bracket"></i>
          
        </a>
        <div class="h-10 w-10 rounded-full bg-amber-100 flex items-center justify-center text-amber-800 border border-amber-300 ml-auto sm:ml-0">
          <i class="fas fa-user text-sm"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-10">
    <div class="mb-8">
      <div class="flex items-center gap-3 mb-1">
        <h1 class="text-3xl font-bold text-amber-950">Hello, <span class="text-amber-700"><%= name %></span></h1>
      </div>
    </div>

    <div class="bg-[#fff8ea] backdrop-blur-sm rounded-2xl border border-amber-300 p-6 md:p-7 mb-8 shadow-sm">
      <div class="flex items-start sm:items-center gap-3 mb-6">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-white">
          <i class="fab fa-google"></i>
        </div>
        <div>
          <h3 class="font-semibold text-xl text-amber-950">Give Review & Earn Money</h3>
          <p class="text-xs text-amber-700 mt-0.5">Each link can be claimed only once.</p>
        </div>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 text-sm">
        <% if (reviewLinks && reviewLinks.length) { %>
          <% reviewLinks.forEach(function(link) { %>
            <a
              href="<%= link.url %>"
              class="reward-link group flex flex-col sm:flex-row sm:items-center justify-between gap-3 p-4 bg-[#fdf0d5] border border-amber-300 rounded-xl transition-all duration-200 <%= Number(link.clicked) ? 'opacity-60 pointer-events-none' : 'hover:border-amber-500' %>"
              data-link-id="<%= link.id %>"
              data-claimed="<%= Number(link.clicked) ? '1' : '0' %>"
            >
              <div class="flex items-center gap-3 min-w-0 w-full">
                <div class="h-8 w-8 rounded-lg bg-amber-100 flex items-center justify-center text-amber-700 transition">
                  <i class="fas fa-link text-xs"></i>
                </div>
                <span class="font-medium text-amber-900 truncate max-w-full sm:max-w-[180px]"><%= link.url %></span>
              </div>
              <% if (Number(link.clicked)) { %>
                <span class="flex items-center gap-1 bg-slate-200 text-slate-700 px-3 py-1.5 rounded-full text-xs font-semibold">
                  <i class="fas fa-check"></i> Claimed
                </span>
              <% } else { %>
                <span class="flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1.5 rounded-full text-xs font-semibold transition">
                  <i class="fas fa-coins"></i> +10
                </span>
              <% } %>
            </a>
          <% }) %>
        <% } else { %>
          <div class="col-span-2 p-6 border border-dashed border-amber-300 rounded-xl text-center text-amber-700 bg-[#fdf0d5]">
            <i class="fas fa-inbox text-amber-400/70 text-2xl mb-2"></i>
            <p>No review links available yet. Check back soon!</p>
          </div>
        <% } %>
      </div>

    </div>

    <div class="text-center text-xs text-amber-700 border-t border-amber-300 pt-6 flex flex-wrap items-center justify-center gap-4">
      <span><i class="fab fa-google mr-1 text-amber-500"></i> Google Reviews Integration</span>
      <span class="w-1 h-1 bg-amber-400/60 rounded-full"></span>
      <span><i class="fas fa-bolt mr-1 text-amber-400"></i> Real-time Earnings</span>
      <span class="w-1 h-1 bg-amber-400/60 rounded-full"></span>
      <span><i class="fas fa-shield-alt mr-1 text-emerald-400"></i> Secure Payments</span>
    </div>
  </div>

  <script>
    (function() {
      const rewardLinks = document.querySelectorAll('.reward-link');
      if (!rewardLinks.length) return;

      rewardLinks.forEach((link) => {
        if (link.dataset.claimed === '1') return;

        link.addEventListener('click', async (e) => {
          e.preventDefault();
          const targetUrl = link.href;
          const reviewLinkId = link.dataset.linkId;

          link.classList.add('ring-2', 'ring-amber-400', 'bg-amber-100');

          try {
            const res = await fetch('/dashboard/reward', {
              method: 'POST',
              headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
              body: new URLSearchParams({ reviewLinkId }).toString()
            });

            if (!res.ok) {
              window.location.reload();
              return;
            }
          } catch (err) {
            return;
          }

          window.open(targetUrl, '_blank');
        });
      });
    })();
  </script>

</body>
</html>
